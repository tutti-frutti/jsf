<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;subset=cyrillic,cyrillic-ext" rel="stylesheet">
    <link rel="stylesheet" href="css/libs.min.css">
    <link rel="stylesheet" href="css/main.css">

    <title>Selects</title>

    <style>
        .select {
            display: inline-block;
            vertical-align: top;
            width: 30%;
        }
    </style>
</head>

<body>

    <header class="header"></header>

    <main class="center">
        <div class="select">
            <label for="select-choice">Тип</label>
            <select name="" id="select-choice">
                <option value="select-option">Выбрать</option>
                <option value="sneakers">Кроссовки</option>
                <option value="jackets">Куртки</option>
                <option value="t-shirt">Футболки</option>
                <option value="fourth">Футболки</option>
                <option value="fifth">Пояса</option>
            </select>
            <div class="select-choice-results"></div>
        </div>
        <!--select-->

        <div class="select">
            <label for="select-brand">Бренд</label>
            <select name="" id="select-brand">
                <option value="zero">Выбрать бренд</option>
            </select>
            <div class="select-choice-results"></div>
        </div>
        <!--select-->

        <div class="select">
            <label for="select-model">Модель</label>
            <select name="" id="select-model">
                <option value="zero">Выбрать модель</option>
            </select>
            <div class="select-choice-results"></div>
        </div>
        <!--select-->

        <template id="template-select">
            <section>
               <div class="template-block">
                    <span>Item name:</span>
                    <span class="item-name">Item name</span>
                </div>
                
                <div class="template-block">
                    <span>Article:</span>
                    <span class="article"></span>
                </div>
                
                <div class="template-block">
                    <span>Color:</span>
                    <span class="colors"></span>
                </div>
                
                <div class="template-block">
                    <span>Price:</span>
                    <span class="price"></span>
                </div>
            </section>
        </template>
    </main>

    <footer></footer>

    <script src="js/libs.min.js"></script>
    <script src="js/common.js"></script>
    <script>
        var container = document.querySelector('.select-choice-results');

        $('#select-choice').change(function() {
            var types = $(this).val();
            $.ajax({
                type: 'GET',
                url: 'js/data/select.json',
                dataType: 'json',
                success: function(data) {
                    $('#select-brand').empty();
                    $('#select-brand').append('<option value="">Выбрать бренд</option>');
                    for (var i in data[types]) {
                        $('#select-brand').append('<option value="' + data[types][i].name + '">' + data[types][i].name + '</option>');
                    }
                },
                error: function() {
                    console.log('cannot get data')
                }
            });
        });
        
        // var types = $(this).val(); --> получаем значение выбранного option
        // data --> массив загруженных данных из json 
        // data[types] --> массив с обращением по имени к элементам массива (sneakers, jackets, t-shirt)
        // for (var i in data[types]) --> перебор массива
        // $('#select-brand').append('<option value="' + data[types][i].name + '">' + data[types][i].name + '</option>');
        // ' + data[types][i].name + ' --> записываем в каждый option name элемента массива data[types]

        $('#select-brand').change(function() {
            var brand = $(this).val(); 
            var selectedType = $('#select-choice option:selected').val();
            $.ajax({
                type: 'GET',
                url: 'js/data/select.json',
                dataType: 'json',
                success: function(data) {
                    $('#select-model').empty();
                    $('#select-model').append('<option value="">Выбрать модель</option>');
                    for (var i in data[selectedType]) {
                        for (var j in data[selectedType][i].models) {
                            if (data[selectedType][i].name == brand) {
                                $('#select-model').append('<option value="' + data[selectedType][i].models[j].model + '">' + data[selectedType][i].models[j].model + '</option>');
                            }
                        }
                    }
                }
            });
        });
        
        // 

        function renderItems(loaded) {
            var select = $('#select-choice');
            $(select).change(function() {
                var options = select.val();
                var filtered = loaded.filter(function(items, i) {
                    var name = loaded[i].name;
                    if (name == options) {
                        return loaded[i].name;
                    }
                })
                container.innerHTML = '';
                filtered.forEach(function(item) {
                    var element = getFromTemplate(item);
                    container.appendChild(element);
                });

            })
        }

        function getFromTemplate(data) {
            var template = document.getElementById('template-select');
            var element = template.content.children[0].cloneNode(true);

            element.querySelector('.item-name').textContent = data.name;
            element.querySelector('.article').textContent = data.sku;
            element.querySelector('.colors').textContent = data.colors;
            element.querySelector('.price').textContent = data.price;
            return element;
        }
    </script>
</body>

</html>